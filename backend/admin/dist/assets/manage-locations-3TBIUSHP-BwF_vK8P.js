import{K as _}from"./chunk-6HTZNHPT-fV5RBr_f.js";import{b as x,u as z}from"./chunk-4TC5YS65-Do6_f7wk.js";import{ab as S,b as L,eR as k,dQ as F,j as e,H as I,r as f,aw as T,ax as C,aq as j,K as E,eY as B,t as v,a1 as r,B as y,aB as M,ar as R,as as b,W as A,a0 as D}from"./index-Dj5zw04S.js";var H=({selected:a,onSelect:i,location:s})=>{var l,d,n;return e.jsxs("div",{className:A("flex w-full cursor-pointer gap-x-2 rounded-lg border px-2 py-2",{"border-ui-border-interactive ":a}),onClick:()=>i(!a),children:[e.jsx("div",{className:"h-5 w-5",children:e.jsx(D,{onClick:o=>{o.stopPropagation(),i(!a)},checked:a})}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:s.name}),e.jsx(r,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:[(l=s.address)==null?void 0:l.address_1,(d=s.address)==null?void 0:d.city,(n=s.address)==null?void 0:n.country_code].filter(o=>!!o).join(", ")})]})]})},K=j({locations:M(j({id:b(),location_id:b(),selected:R()}))}),w=(a,i)=>({locations:a.map(s=>({...s,location_id:s.id,selected:i.has(s.id)}))}),P=({item:a,locations:i})=>{const s=f.useMemo(()=>{var t;return new Set(((t=a.location_levels)==null?void 0:t.map(u=>u.location_id))??[])},a.location_levels),{t:l}=L(),{handleSuccess:d}=z(),n=T({defaultValues:w(i,s),resolver:C(K)}),{fields:o,update:h}=E({control:n.control,name:"locations"});f.useEffect(()=>{n.setValue("locations",w(i,s).locations)},[s,i]);const{mutateAsync:p}=B(a.id),N=n.handleSubmit(async({locations:t})=>{const[u,g]=t.reduce((c,m)=>(!m.selected&&!s.has(m.location_id)||m.selected&&s.has(m.location_id)||(m.selected?c[0].push(m.location_id):c[1].push(m.location_id)),c),[[],[]]);if(u.length===0&&g.length===0)return d();await p({create:u.map(c=>({location_id:c})),delete:g},{onSuccess:()=>{v.success(l("inventory.toast.updateLocations")),d()},onError:c=>{v.error(c.message)}})});return e.jsx(x.Form,{form:n,children:e.jsxs(_,{onSubmit:N,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(x.Body,{className:"flex flex-1 flex-col gap-y-4 overflow-auto",children:[e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-2 divide-y rounded-lg border",children:[e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(r,{className:"px-2 py-1.5",size:"small",leading:"compact",children:l("fields.title")}),e.jsx(r,{className:"px-2 py-1.5",size:"small",leading:"compact",children:a.title??"-"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(r,{className:"px-2 py-1.5",size:"small",leading:"compact",children:l("fields.sku")}),e.jsx(r,{className:"px-2 py-1.5",size:"small",leading:"compact",children:a.sku})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r,{size:"small",weight:"plus",leading:"compact",children:l("locations.domain")}),e.jsxs("div",{className:"text-ui-fg-subtle flex w-full justify-between",children:[e.jsx(r,{size:"small",leading:"compact",children:l("locations.selectLocations")}),e.jsxs(r,{size:"small",leading:"compact",children:["(",l("general.countOfTotalSelected",{count:o.filter(t=>t.selected).length,total:i.length}),")"]})]})]}),o.map((t,u)=>e.jsx(H,{selected:t.selected,location:t,onSelect:()=>h(u,{...t,selected:!t.selected})},t.id))]}),e.jsx(x.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(x.Close,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"small",children:l("actions.cancel")})}),e.jsx(y,{type:"submit",size:"small",isLoading:!1,children:l("actions.save")})]})})]})})},Q=()=>{const{id:a}=S(),{t:i}=L(),{inventory_item:s,isPending:l,isError:d,error:n}=k(a),{stock_locations:o,isLoading:h}=F(),p=!l&&!h&&s&&o;if(d)throw n;return e.jsxs(x,{children:[e.jsx(x.Header,{children:e.jsx(I,{children:i("inventory.manageLocations")})}),p&&e.jsx(P,{item:s,locations:o})]})};export{Q as Component};
