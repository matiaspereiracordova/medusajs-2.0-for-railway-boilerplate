import{u as Pe}from"./chunk-C76H5USB-C3dh0QkI.js";import{b as de,d as ue,bo as se,r as d,ao as ke,u as Oe,cy as Ie,j as e,cz as y,H as fe,a1 as he,A as Le,h as Ke,ai as re,bB as v,aJ as Re,P as $e,T as qe,t as L,B,L as Be,aw as ze,cs as S,X as Je,J as Ue,cA as Xe,cB as Qe,cC as Ye,cD as Ce,cE as Ge,cF as We,cG as Ze}from"./index-Dj5zw04S.js";var z=(s,a)=>{let t=a;t||(s instanceof Ze||s.message?t=s.message:t="An error occurred"),L.error(t)},xe=s=>{const a=ue("view_configurations"),t=Xe(s,{limit:100},{enabled:a&&!!s}),n=Qe(s,{enabled:a&&!!s}),c=Ye(s,{onSuccess:()=>{L.success("View created")},onError:j=>{z(j,"Failed to create view")}}),h=Ce(s,{onSuccess:()=>{},onError:j=>{z(j,"Failed to update active view")}});return d.useMemo(()=>({isViewConfigEnabled:a,listViews:t,activeView:n,createView:c,setActiveView:h,isDefaultViewActive:(n==null?void 0:n.is_default_active)??!0}),[a,t,n,c,h])},me=(s,a)=>{const t=Ge(s,a,{onSuccess:()=>{L.success("View updated")},onError:c=>{z(c,"Failed to update view")}}),n=We(s,a,{onSuccess:()=>{L.success("View deleted successfully")},onError:c=>{z(c,"Failed to delete view")}});return{updateView:t,deleteView:n}},He=({entity:s,currentColumns:a,currentConfiguration:t,editingView:n,onClose:c,onSaved:h})=>{const{createView:j}=xe(s),{updateView:D}=me(s,(n==null?void 0:n.id)||""),[P,p]=d.useState(!1),{register:T,handleSubmit:A,formState:{errors:b}}=ze({defaultValues:{name:(n==null?void 0:n.name)||""}}),u=async f=>{if(f.name.trim()){p(!0);try{if(n){const g=await D.mutateAsync({name:f.name.trim(),configuration:{visible_columns:(a==null?void 0:a.visible)||n.configuration.visible_columns,column_order:(a==null?void 0:a.order)||n.configuration.column_order,filters:(t==null?void 0:t.filters)||n.configuration.filters||{},sorting:(t==null?void 0:t.sorting)||n.configuration.sorting||null,search:(t==null?void 0:t.search)||n.configuration.search||""}});h(g.view_configuration)}else{const g=await j.mutateAsync({name:f.name.trim(),set_active:!0,configuration:{visible_columns:(a==null?void 0:a.visible)||[],column_order:(a==null?void 0:a.order)||[],filters:(t==null?void 0:t.filters)||{},sorting:(t==null?void 0:t.sorting)||null,search:(t==null?void 0:t.search)||""}});h(g.view_configuration)}}catch{}finally{p(!1)}}};return e.jsx(S,{open:!0,onOpenChange:c,children:e.jsxs(S.Content,{className:"flex flex-col",children:[e.jsxs(S.Header,{children:[e.jsx(S.Title,{asChild:!0,children:e.jsx(fe,{children:n?"Edit View Name":"Save as New View"})}),e.jsx(S.Description,{asChild:!0,children:e.jsx(he,{children:n?"Change the name of your saved view":"Save your current configuration as a new view"})})]}),e.jsxs("form",{onSubmit:A(u),className:"flex flex-1 flex-col",children:[e.jsx(S.Body,{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(Je,{htmlFor:"name",weight:"plus",children:"View Name"}),e.jsx(Ue,{...T("name",{required:"Name is required",validate:f=>f.trim().length>0||"Name cannot be empty"}),type:"text",placeholder:"Enter view name",autoFocus:!0}),b.name&&e.jsx("span",{className:"text-sm text-ui-fg-error",children:b.name.message})]})}),e.jsxs(S.Footer,{children:[e.jsx(S.Close,{asChild:!0,children:e.jsx(B,{variant:"secondary",size:"small",type:"button",children:"Cancel"})}),e.jsx(B,{variant:"primary",size:"small",type:"submit",isLoading:P,children:n?"Update":"Save"})]})]})]})})},es=({entity:s,currentColumns:a,currentConfiguration:t})=>{const{listViews:n,activeView:c,setActiveView:h,isDefaultViewActive:j}=xe(s),D=(n==null?void 0:n.view_configurations)||[],[P,p]=d.useState(!1),[T,A]=d.useState(null),[b,u]=d.useState(null),[f,g]=d.useState({x:0,y:0}),[r,w]=d.useState(null),K=Ke(),k=(c==null?void 0:c.view_configuration)||null,{deleteView:O}=me(s,r||""),R=async l=>{try{if(l===null){await h.mutateAsync(null);return}D.find(Q=>Q.id===l)&&await h.mutateAsync(l)}catch(m){console.error("Error in handleViewSelect:",m)}},J=async l=>{await K({title:"Delete view",description:`Are you sure you want to delete "${l.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel"})&&w(l.id)};d.useEffect(()=>{r&&O.mutateAsync&&O.mutateAsync().then(()=>{w(null)}).catch(()=>{w(null)})},[r,O.mutateAsync]);const _=l=>{A(l),p(!0)},F=async l=>{await K({title:"Reset system default",description:"This will delete the saved system default and revert to the original code-level defaults. All users will be affected. Are you sure?",confirmText:"Reset",cancelText:"Cancel"})&&w(l.id)},M=D.find(l=>l.is_system_default),I=D.filter(l=>!l.is_system_default),U=j;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx(re,{color:U?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>R(null),onContextMenu:l=>{l.preventDefault(),M&&(g({x:l.clientX,y:l.clientY}),u("default"))},children:"Default"}),M&&b==="default"&&e.jsxs(v,{open:!0,onOpenChange:l=>{l||u(null)},children:[e.jsx(v.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:f.x,top:f.y,width:0,height:0}})}),e.jsx(v.Content,{align:"start",sideOffset:0,children:e.jsxs(v.Item,{onClick:()=>{F(M),u(null)},className:"flex items-center gap-x-2",children:[e.jsx(Re,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Reset to code defaults"})]})})]})]}),I.length>0&&e.jsx("div",{className:"text-ui-fg-muted",children:"|"}),I.map(l=>e.jsxs("div",{className:"relative inline-block",children:[e.jsx(re,{color:(k==null?void 0:k.id)===l.id?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>R(l.id),onContextMenu:m=>{m.preventDefault(),g({x:m.clientX,y:m.clientY}),u(l.id)},children:l.name}),b===l.id&&e.jsxs(v,{open:!0,onOpenChange:m=>{m||u(null)},children:[e.jsx(v.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:f.x,top:f.y,width:0,height:0}})}),e.jsxs(v.Content,{align:"start",sideOffset:0,children:[e.jsxs(v.Item,{onClick:()=>{_(l),u(null)},className:"flex items-center gap-x-2",children:[e.jsx($e,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Edit name"})]}),e.jsxs(v.Item,{onClick:()=>{J(l),u(null)},className:"flex items-center gap-x-2 text-ui-fg-error",children:[e.jsx(qe,{}),e.jsx("span",{children:"Delete"})]})]})]})]},l.id))]}),P&&e.jsx(He,{entity:s,currentColumns:a,currentConfiguration:t,editingView:T,onClose:()=>{p(!1),A(null)},onSaved:async l=>{p(!1),A(null),L.success(`View "${l.name}" saved successfully`)}})]})},us=({data:s=[],columns:a,filters:t,commands:n,action:c,actions:h,actionMenu:j,getRowId:D,rowCount:P=0,enablePagination:p=!0,enableSearch:T=!0,autoFocusSearch:A=!1,enableFilterMenu:b,rowHref:u,heading:f,subHeading:g,prefix:r,pageSize:w=10,emptyState:K,rowSelection:k,isLoading:O=!1,layout:R="auto",enableColumnVisibility:J=!1,initialColumnVisibility:_={},onColumnVisibilityChange:F,columnOrder:M,onColumnOrderChange:I,enableViewSelector:U=!1,entity:X,currentColumns:l,filterBarContent:m})=>{const{t:Q}=de(),te=ue("view_configurations"),ae=te&&J,je=te&&U,ne=t&&t.length>0,pe=b!==void 0?b:ne,ve=n&&n.length>0,Y=a.some(o=>o.enableSorting),[C,le]=se.useState(_);se.useEffect(()=>{const o=Object.keys(C).sort(),i=Object.keys(_).sort();(o.length!==i.length||o.some((E,V)=>E!==i[V])||Object.entries(_).some(([E,V])=>C[E]!==V))&&le(_)},[_]);const be=se.useCallback(o=>{le(o),F==null||F(o)},[F]),$=d.useMemo(()=>(t==null?void 0:t.map(o=>o.id))??[],[t]),we=$.map(o=>N(o,r)),{offset:G,order:W,q:oe,...ie}=Pe([...$,...Y?["order"]:[],...T?["q"]:[],...p?["offset"]:[]],r),[cs,q]=ke(),Z=d.useMemo(()=>oe??"",[oe]),ye=o=>{q(i=>(o?i.set(N("q",r),o):i.delete(N("q",r)),i))},Se=d.useMemo(()=>G?ns(G,w):{pageIndex:0,pageSize:w},[G,w]),Ne=o=>{q(i=>(o.pageIndex===0?i.delete(N("offset",r)):i.set(N("offset",r),as(o).toString()),i))},H=d.useMemo(()=>ls($,ie),[$,ie]),De=o=>{q(i=>(Array.from(i.keys()).forEach(x=>{we.includes(x)&&((r?x.replace(`${r}_`,""):x)in o||i.delete(x))}),Object.entries(o).forEach(([x,E])=>{const V=N(x,r);E!==void 0?i.set(V,JSON.stringify(E)):i.delete(V)}),i))},ee=d.useMemo(()=>W?ts(W):null,[W]),Te=d.useMemo(()=>({filters:H,sorting:ee,search:Z}),[H,ee,Z]),Ae=o=>{q(i=>{if(o){const x=ss(o);i.set(N("order",r),x)}else i.delete(N("order",r));return i})},{pagination:_e,toolbar:Ee}=os(),ce=Oe(),Fe=d.useCallback((o,i)=>{if(!u)return;const x=u(i);if(o.metaKey||o.ctrlKey||o.button===1){window.open(x,"_blank","noreferrer");return}if(o.shiftKey){window.open(x,void 0,"noreferrer");return}ce(x)},[ce,u]),Me=Ie({data:s,columns:a,filters:t,commands:n,rowCount:P,getRowId:D,onRowClick:u?Fe:void 0,pagination:p?{state:Se,onPaginationChange:Ne}:void 0,filtering:ne?{state:H,onFilteringChange:De}:void 0,sorting:Y?{state:ee,onSortingChange:Ae}:void 0,search:T?{state:Z,onSearchChange:ye}:void 0,rowSelection:k,isLoading:O,columnVisibility:ae?{state:C,onColumnVisibilityChange:be}:void 0,columnOrder:ae&&M&&I?{state:M,onColumnOrderChange:I}:void 0}),Ve=f||g;return e.jsxs(y,{instance:Me,className:R==="fill"?"h-full [&_tr]:last-of-type:!border-b":void 0,children:[e.jsx(y.Toolbar,{className:"flex flex-col items-start justify-between gap-2 md:flex-row md:items-center",translations:Ee,filterBarContent:m,children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-x-4",children:[Ve&&e.jsxs("div",{children:[f&&e.jsx(fe,{children:f}),g&&e.jsx(he,{size:"small",className:"text-ui-fg-subtle",children:g})]}),je&&X&&e.jsx(es,{entity:X,currentColumns:l,currentConfiguration:Te})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[pe&&e.jsx(y.FilterMenu,{}),Y&&e.jsx(y.SortingMenu,{}),T&&e.jsx("div",{className:"w-full md:w-auto",children:e.jsx(y.Search,{placeholder:Q("filters.searchLabel"),autoFocus:A})}),j&&e.jsx(Le,{variant:"primary",...j}),h&&h.length>0&&e.jsx(is,{actions:h}),!h&&c&&e.jsx(ge,{...c})]})]})}),e.jsx(y.Table,{emptyState:K}),p&&e.jsx(y.Pagination,{translations:_e}),ve&&e.jsx(y.CommandBar,{selectedLabel:o=>`${o} selected`})]})};function ss(s){return s.desc?`-${s.id}`:s.id}function ts(s){return s.startsWith("-")?{id:s.slice(1),desc:!0}:{id:s,desc:!1}}function as(s){return s.pageIndex*s.pageSize}function ns(s,a){const t=parseInt(s);return{pageIndex:Math.floor(t/a),pageSize:a}}function ls(s,a){if(!a)return{};const t={};for(const n of s){const c=a[n];c!==void 0&&(t[n]=JSON.parse(c))}return t}function N(s,a){return a?`${a}_${s}`:s}var os=()=>{const{t:s}=de(),a={of:s("general.of"),results:s("general.results"),pages:s("general.pages"),prev:s("general.prev"),next:s("general.next")},t={clearAll:s("actions.clearAll"),sort:s("filters.sortLabel"),columns:"Columns"};return{pagination:a,toolbar:t}},ge=({label:s,disabled:a,...t})=>{const n={size:"small",disabled:a??!1,type:"button",variant:"secondary"};return"to"in t?e.jsx(B,{...n,asChild:!0,children:e.jsx(Be,{to:t.to,children:s})}):e.jsx(B,{...n,onClick:t.onClick,children:s})},is=({actions:s})=>e.jsx("div",{className:"flex items-center gap-x-2",children:s.map((a,t)=>e.jsx(ge,{...a},t))});export{us as D,He as S,me as a,xe as u};
