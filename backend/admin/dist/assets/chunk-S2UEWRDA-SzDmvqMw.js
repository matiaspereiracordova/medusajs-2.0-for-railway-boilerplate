import{K as S}from"./chunk-6HTZNHPT-fV5RBr_f.js";import{b as o,u as B}from"./chunk-4TC5YS65-Do6_f7wk.js";import{b as A,j as e,H as M,b2 as g,aw as _,ax as L,aq as I,t as N,K as V,dn as H,W as y,I as b,r as O,bB as x,Z as K,dG as P,dH as U,dI as $,T as z,a2 as G,B as T,aB as Y,aS as q,ar as J,as as W}from"./index-Dj5zw04S.js";var Z=I({key:W(),disabled:J().optional(),value:q()}),Q=I({metadata:Y(Z)}),de=t=>{const{t:l}=A(),{isPending:a,...s}=t;return e.jsxs(o,{children:[e.jsxs(o.Header,{children:[e.jsx(o.Title,{asChild:!0,children:e.jsx(M,{children:l("metadata.edit.header")})}),e.jsx(o.Description,{className:"sr-only",children:l("metadata.edit.description")})]}),a?e.jsx(ee,{}):e.jsx(X,{...s})]})},E="metadata-form-key-label",k="metadata-form-value-label",X=({metadata:t,hook:l,isMutating:a})=>{const{t:s}=A(),{handleSuccess:c}=B(),u=te(t),r=_({defaultValues:{metadata:ae(t)},resolver:L(Q)}),i=r.handleSubmit(async d=>{const n=se(d,t);await l({metadata:n},{onSuccess:()=>{N.success(s("metadata.edit.successToast")),c()},onError:m=>{N.error(m.message)}})}),{fields:h,insert:p,remove:R}=V({control:r.control,name:"metadata"});function C(d){R(d),h.length===1&&p(0,{key:"",value:"",disabled:!1})}function w(d,n){p(d+(n==="above"?0:1),{key:"",value:"",disabled:!1})}return e.jsx(o.Form,{form:r,children:e.jsxs(S,{onSubmit:i,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(o.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:[e.jsxs("div",{className:"bg-ui-bg-base shadow-elevation-card-rest grid grid-cols-1 divide-y rounded-lg",children:[e.jsxs("div",{className:"bg-ui-bg-subtle grid grid-cols-2 divide-x rounded-t-lg",children:[e.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:e.jsx("label",{id:E,children:s("metadata.edit.labels.key")})}),e.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:e.jsx("label",{id:k,children:s("metadata.edit.labels.value")})})]}),h.map((d,n)=>{const m=d.disabled||!1;let f="-";return typeof d.value=="object"&&(f="{ ... }"),Array.isArray(d.value)&&(f="[ ... ]"),e.jsx(H,{showTooltip:m,content:s("metadata.edit.complexRow.tooltip"),children:e.jsxs("div",{className:"group/table relative",children:[e.jsxs("div",{className:y("grid grid-cols-2 divide-x",{"overflow-hidden rounded-b-lg":n===h.length-1}),children:[e.jsx(b.Field,{control:r.control,name:`metadata.${n}.key`,render:({field:j})=>e.jsx(b.Item,{children:e.jsx(b.Control,{children:e.jsx(v,{"aria-labelledby":E,...j,disabled:m,placeholder:"Key"})})})}),e.jsx(b.Field,{control:r.control,name:`metadata.${n}.value`,render:({field:{value:j,...D}})=>e.jsx(b.Item,{children:e.jsx(b.Control,{children:e.jsx(v,{"aria-labelledby":k,...D,value:m?f:j,disabled:m,placeholder:"Value"})})})})]}),e.jsxs(x,{children:[e.jsx(x.Trigger,{className:y("invisible absolute inset-y-0 -right-2.5 my-auto group-hover/table:visible data-[state='open']:visible",{hidden:m}),disabled:m,asChild:!0,children:e.jsx(K,{size:"2xsmall",children:e.jsx(P,{})})}),e.jsxs(x.Content,{children:[e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>w(n,"above"),children:[e.jsx(U,{className:"text-ui-fg-subtle"}),s("metadata.edit.actions.insertRowAbove")]}),e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>w(n,"below"),children:[e.jsx($,{className:"text-ui-fg-subtle"}),s("metadata.edit.actions.insertRowBelow")]}),e.jsx(x.Separator,{}),e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>C(n),children:[e.jsx(z,{className:"text-ui-fg-subtle"}),s("metadata.edit.actions.deleteRow")]})]})]})]})},d.id)})]}),u&&e.jsx(G,{variant:"warning",label:s("metadata.edit.complexRow.label"),children:s("metadata.edit.complexRow.description")})]}),e.jsx(o.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(o.Close,{asChild:!0,children:e.jsx(T,{size:"small",variant:"secondary",type:"button",disabled:a,children:s("actions.cancel")})}),e.jsx(T,{size:"small",type:"submit",isLoading:a,children:s("actions.save")})]})})]})})},v=O.forwardRef(({className:t,...l},a)=>e.jsx("input",{ref:a,...l,autoComplete:"off",className:y("txt-compact-small text-ui-fg-base placeholder:text-ui-fg-muted disabled:text-ui-fg-disabled disabled:bg-ui-bg-base bg-transparent px-2 py-1.5 outline-none",t)}));v.displayName="MetadataForm.GridInput";var ee=()=>e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(o.Body,{children:e.jsx(g,{className:"h-[148ox] w-full rounded-lg"})}),e.jsx(o.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(g,{className:"h-7 w-12 rounded-md"}),e.jsx(g,{className:"h-7 w-12 rounded-md"})]})})]}),F=["string","number","boolean"];function ae(t){return!t||!Object.keys(t).length?[{key:"",value:"",disabled:!1}]:Object.entries(t).map(([l,a])=>{if(!F.includes(typeof a))return{key:l,value:a,disabled:!0};let s=a;return typeof a!="string"&&(s=JSON.stringify(a)),{key:l,value:s,original_key:l}})}function se(t,l){const a=t.metadata;if(!a.length||a.length===1&&!a[0].key&&!a[0].value)return null;const c={};return l&&Object.keys(l).forEach(u=>{a.some(i=>i.key===u)||(c[u]="")}),a.forEach(u=>{let r=u.key,i=u.value;const h=u.disabled;if(r){if(h){c[r]=i;return}r=r.trim(),i=(i==null?void 0:i.trim())??"",i==="true"?c[r]=!0:i==="false"?c[r]=!1:/^-?\d*\.?\d+$/.test(i)?c[r]=parseFloat(i):c[r]=i}}),c}function te(t){return t?Object.values(t).some(l=>!F.includes(typeof l)):!1}export{de as M};
